# Templates and Schemas

Reference templates and schemas for validate-story skill.

---

## Story Template Schema

Expected story template structure from create-story skill.

### Required Sections

1. **Frontmatter (YAML)**
   ```yaml
   ---
   epic_id: "epic-001"
   story_id: "story-003"
   title: "User Authentication System"
   status: "Draft"
   created: "2025-01-15"
   ---
   ```

2. **Objective**
   - Clear, concise statement of what story achieves
   - 1-3 sentences

3. **Context**
   - Background information
   - Why this story is needed
   - How it fits into epic/product

4. **Acceptance Criteria**
   - Numbered list (AC1, AC2, AC3, ...)
   - Each criterion measurable and testable
   - Clear success conditions

5. **Tasks/Subtasks**
   - Numbered hierarchical list
   - Each task actionable
   - Logical order with dependencies

6. **Dev Notes**
   - Technical implementation approach
   - Key technical decisions
   - Integration points
   - Potential gotchas
   - File structure overview

7. **Testing & Validation**
   - Testing strategy
   - Test scenarios
   - Validation steps
   - Testing tools

8. **File List**
   - New files to create
   - Existing files to modify
   - File paths relative to project root

9. **Dependencies**
   - External libraries/services
   - Other stories/tasks
   - System dependencies

### Optional Sections

- UI/UX Specifications
- Security Considerations
- Performance Requirements
- Database Changes
- API Changes

---

## Validation Report Template

Format for validation report generated by Step 10.

### Report Structure

```markdown
# Story Validation Report

**Story:** {epic-id}/{story-id} - {title}
**Validated:** {date} {time}
**Validator:** validate-story skill v{version}
**Validation Mode:** {full | quick | critical_only}

---

## Executive Summary

**Decision:** ✅ GO | ❌ NO-GO
**Readiness Score:** {score}/10
**Confidence Level:** {High | Medium | Low}

**Critical Issues:** {count} (must fix before implementation)
**Should-Fix Issues:** {count} (recommended improvements)
**Nice-to-Have:** {count} (optional enhancements)
**Anti-Hallucination Findings:** {count} (unverified claims)

---

## Validation Results

### Step 1: Template Completeness
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL

**Findings:**
- All required sections present: {Yes/No}
- No unfilled placeholders: {Yes/No}
- Meaningful content in all sections: {Yes/No}

{If issues:}
**Issues:**
- Missing section: "{section_name}"
- Unfilled placeholder: "{placeholder}" in {section}
- Empty section: "{section_name}"

---

### Step 2: File Structure & Source Tree
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL

**Findings:**
- File paths match project structure: {Yes/No}
- Consistent directory naming: {Yes/No}
- Appropriate file locations: {Yes/No}
- No invented directories: {Yes/No}

{If issues:}
**Issues:**
- Invalid path: "{path}" (should be "{correct_path}")
- Inconsistent directory: "{dir}" (project uses "{correct_dir}")
- Wrong location: "{file}" (should be in "{correct_location}")

---

### Step 3: UI/Frontend Completeness
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL | N/A

{If UI story:}
**Findings:**
- Component specifications: {Complete/Partial/Missing}
- Styling/design guidance: {Complete/Partial/Missing}
- User interaction flows: {Complete/Partial/Missing}
- Responsive/accessibility: {Addressed/Not Addressed}
- Frontend-backend integration: {Clear/Unclear}

---

### Step 4: Acceptance Criteria Satisfaction
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL

**Coverage Analysis:**
{For each AC:}
- AC{n}: "{description}"
  - Tasks: {task_numbers}
  - Coverage: ✅ Full | ⚠️ Partial | ❌ None

**Findings:**
- All ACs have implementing tasks: {Yes/No}
- All ACs testable and measurable: {Yes/No}
- Edge cases covered: {Yes/No}

{If issues:}
**Uncovered ACs:**
- AC{n}: "{description}" - No implementing tasks

**Partial Coverage:**
- AC{n}: "{description}" - Missing {what's missing}

**Vague ACs:**
- AC{n}: "{description}" - Not measurable/testable

---

### Step 5: Testing & Validation Instructions
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL

**Findings:**
- Testing strategy clear: {Yes/No}
- Test scenarios identified: {Yes/No}
- Validation steps specific: {Yes/No}
- Testing tools specified: {Yes/No}
- Test data requirements: {Identified/Not Identified}

---

### Step 6: Security Considerations
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL | N/A

{If security-critical:}
**Findings:**
- Security requirements identified: {Yes/No}
- Authentication/authorization specified: {Yes/No}
- Data protection clear: {Yes/No}
- Vulnerability prevention addressed: {Yes/No}
- Compliance requirements: {Addressed/Not Addressed}

---

### Step 7: Tasks/Subtasks Sequence
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL

**Findings:**
- Logical order: {Yes/No}
- Clear dependencies: {Yes/No}
- Appropriate granularity: {Yes/No}
- Complete (all steps): {Yes/No}
- All tasks actionable: {Yes/No}

---

### Step 8: Anti-Hallucination Verification
**Status:** ✅ PASS | ⚠️ CONCERNS | ❌ FAIL

**Findings:**
- All file/directory names verified: {Yes/No}
- All libraries verified in dependencies: {Yes/No}
- All API endpoints verified: {Yes/No}
- All architecture patterns verified: {Yes/No}

{If findings:}
**Hallucinated Details ({count}):**

1. **{category}:** "{detail}"
   - **Claim:** {what story claims}
   - **Reality:** {what's actually in sources}
   - **Source Checked:** {which doc was checked}
   - **Fix:** {how to correct}

---

### Step 9: Dev Agent Implementation Readiness
**Status:** ✅ READY | ⚠️ NEEDS WORK | ❌ NOT READY

**Readiness Score:** {score}/10

**Assessment:**
- Self-contained context: {Yes/No}
- Clear instructions: {Yes/No}
- Complete technical context: {Yes/No}
- All tasks actionable: {Yes/No}

**Missing Context:**
{List missing technical details}

**Vague Instructions:**
{List ambiguous tasks}

---

## Issue Summary

### Critical Issues ({count}) - MUST FIX

{For each critical issue:}
**{Issue #}: [{SECTION}] {Issue Title}**
- **Location:** {section or line}
- **Problem:** {detailed description}
- **Impact:** {why this blocks implementation}
- **Fix:** {specific steps to fix}

---

### Should-Fix Issues ({count}) - RECOMMENDED

{For each should-fix:}
**{Issue #}: [{SECTION}] {Issue Title}**
- **Location:** {section or line}
- **Recommendation:** {how to improve}
- **Benefit:** {why this matters}

---

### Nice-to-Have ({count}) - OPTIONAL

{For each nice-to-have:}
**{Issue #}: [{SECTION}] {Suggestion}**
- **Enhancement:** {what could be added}

---

### Anti-Hallucination Findings ({count})

{For each finding:}
**{Finding #}: {Claim}**
- **Claimed:** "{detail from story}"
- **Source:** {doc checked}
- **Status:** Not found / Contradicts source
- **Fix:** Remove claim OR source from {correct doc}

---

## Recommendation

### Decision: ✅ GO | ❌ NO-GO

**Rationale:**
{Explanation of decision based on critical issues, readiness score, confidence}

{If GO:}
✅ **PROCEED TO IMPLEMENTATION**

Story is ready for James (Developer Agent). {count} should-fix issues can be addressed during implementation.

**Next Steps:**
1. Hand to James: `@james *implement {story-id}`
2. Monitor should-fix issues during development
3. Address anti-hallucination findings in next iteration

{If NO-GO:}
❌ **DO NOT PROCEED - FIX CRITICAL ISSUES FIRST**

Story has {count} critical issues that must be resolved before implementation.

**Next Steps:**
1. Fix all critical issues listed above
2. Re-validate: `@validate-story {story-file}`
3. Address should-fix issues (recommended)
4. Proceed to implementation once validation passes

---

## Metrics

- **Validation Duration:** {duration_ms}ms
- **Template Compliance:** {percentage}%
- **AC Coverage:** {percentage}%
- **Implementation Readiness:** {score}/10
- **Confidence Level:** {High/Medium/Low}

---

*Generated by validate-story skill - BMAD Enhanced Planning Suite*
```

---

## Example Reports

### Example 1: GO Decision

```markdown
# Story Validation Report

**Story:** epic-001/story-003 - User Authentication System
**Validated:** 2025-01-15 14:30:00
**Validator:** validate-story skill v1.0.0
**Validation Mode:** full

---

## Executive Summary

**Decision:** ✅ GO
**Readiness Score:** 9/10
**Confidence Level:** High

**Critical Issues:** 0
**Should-Fix Issues:** 2
**Nice-to-Have:** 3
**Anti-Hallucination Findings:** 0

---

## Validation Results

### Step 1: Template Completeness
**Status:** ✅ PASS

All required sections present with meaningful content.

### Step 2: File Structure & Source Tree
**Status:** ✅ PASS

All file paths match project structure.

[... all steps PASS ...]

---

## Recommendation

### Decision: ✅ GO

**Rationale:**
Story is comprehensive and ready for implementation. Zero critical issues, high readiness score (9/10), and high confidence. Two should-fix issues are minor and can be addressed during development.

✅ **PROCEED TO IMPLEMENTATION**

**Next Steps:**
1. Hand to James: `@james *implement story-003`
2. Address should-fix issues:
   - Add integration test scenarios
   - Specify error message formats
```

---

### Example 2: NO-GO Decision

```markdown
# Story Validation Report

**Story:** epic-002/story-005 - Payment Processing
**Validated:** 2025-01-15 15:45:00
**Validator:** validate-story skill v1.0.0
**Validation Mode:** full

---

## Executive Summary

**Decision:** ❌ NO-GO
**Readiness Score:** 5/10
**Confidence Level:** Low

**Critical Issues:** 4
**Should-Fix Issues:** 6
**Nice-to-Have:** 2
**Anti-Hallucination Findings:** 2

---

## Issue Summary

### Critical Issues (4) - MUST FIX

**Issue #1: [TEMPLATE] Missing "Testing & Validation" Section**
- **Location:** Required section missing
- **Problem:** Story has no testing section
- **Impact:** No test strategy defined, developer won't know how to validate
- **Fix:** Add "Testing & Validation" section with test approach, scenarios, tools

**Issue #2: [AC] AC3 "Secure payment storage" Has No Implementing Tasks**
- **Location:** Acceptance Criteria section
- **Problem:** AC3 is listed but no tasks address it
- **Impact:** Critical AC won't be implemented
- **Fix:** Add tasks to implement secure payment storage with encryption

**Issue #3: [HALLUCINATION] Claims "Stripe API" Not in Dependencies**
- **Location:** Dev Notes section
- **Problem:** Story mentions using Stripe but package.json has no stripe dependency
- **Impact:** Developer will try to use library that doesn't exist
- **Fix:** Add stripe to package.json OR use different payment processor already in deps

**Issue #4: [FILES] References "src/services/payment.ts" Not in Project Structure**
- **Location:** File List section
- **Problem:** Project uses "src/payments/" not "src/services/payment.ts"
- **Impact:** Files created in wrong location, breaks project structure
- **Fix:** Update paths to "src/payments/processor.ts"

---

## Recommendation

### Decision: ❌ NO-GO

**Rationale:**
Story has 4 critical issues including missing required section, uncovered AC, hallucinated library, and incorrect file structure. Readiness score 5/10 with low confidence. Must fix all critical issues before implementation.

❌ **DO NOT PROCEED - FIX CRITICAL ISSUES FIRST**

**Next Steps:**
1. Add "Testing & Validation" section
2. Add tasks for AC3 (secure payment storage)
3. Fix Stripe library reference (add to deps or use alternative)
4. Correct file paths to match project structure
5. Re-validate: `@validate-story .claude/stories/epic-002/story-005.md`
6. Address 6 should-fix issues (recommended)
```

---

## Readiness Score Calculation

### Base Score

Start with 10 points.

### Deductions

**Critical Issues:**
- -2 points per critical issue

**Should-Fix Issues:**
- -0.5 points per should-fix issue

**Anti-Hallucination Findings:**
- -1 point per hallucination

**Formula:**
```
score = max(1, 10 - (critical × 2) - (should_fix × 0.5) - (hallucinations × 1))
```

### Examples

**Example 1:**
- Critical: 0
- Should-Fix: 2
- Hallucinations: 0
- **Score:** 10 - (0×2) - (2×0.5) - (0×1) = 9

**Example 2:**
- Critical: 2
- Should-Fix: 5
- Hallucinations: 1
- **Score:** 10 - (2×2) - (5×0.5) - (1×1) = 10 - 4 - 2.5 - 1 = 2.5 ≈ 3

**Example 3:**
- Critical: 4
- Should-Fix: 6
- Hallucinations: 2
- **Score:** 10 - (4×2) - (6×0.5) - (2×1) = 10 - 8 - 3 - 2 = -3 → **1** (minimum)

---

## Confidence Level Determination

### High Confidence

**Criteria:**
- Readiness score ≥ 8
- Zero critical issues
- ≤ 2 should-fix issues
- Zero anti-hallucination findings

**Interpretation:** Very likely to succeed in implementation without issues.

### Medium Confidence

**Criteria:**
- Readiness score 5-7
- ≤ 3 critical issues
- ≤ 5 should-fix issues
- ≤ 2 anti-hallucination findings

**Interpretation:** Can proceed but expect some clarifications needed during implementation.

### Low Confidence

**Criteria:**
- Readiness score ≤ 4
- > 3 critical issues
- > 5 should-fix issues
- > 2 anti-hallucination findings

**Interpretation:** High risk of implementation failure, significant rework likely needed.

---

## GO/NO-GO Decision Matrix

| Readiness Score | Critical Issues | Anti-Hallucination | Decision | Confidence |
|-----------------|-----------------|-------------------|----------|------------|
| 9-10 | 0 | 0 | GO | High |
| 8-9 | ≤1 | 0-1 | GO | High |
| 7-8 | ≤2 | ≤1 | GO | Medium |
| 6-7 | ≤2 | ≤2 | GO (with caution) | Medium |
| 5-6 | ≤3 | ≤2 | NO-GO | Medium |
| 4-5 | >2 | >1 | NO-GO | Low |
| 1-3 | Any | Any | NO-GO | Low |

**Override Rule:**
- If any critical anti-hallucination finding (hallucinated architecture) → NO-GO regardless of score

---

## Telemetry Schema

Telemetry emitted after validation complete:

```json
{
  "event": "skill.validate-story.completed",
  "timestamp": "2025-01-15T14:30:00Z",
  "data": {
    "story_id": "story-003",
    "epic_id": "epic-001",
    "validation_mode": "full",

    "decision": {
      "validation_passed": true,
      "decision": "GO",
      "readiness_score": 9,
      "confidence_level": "High"
    },

    "issues": {
      "critical_issues_count": 0,
      "should_fix_count": 2,
      "nice_to_have_count": 3,
      "anti_hallucination_count": 0
    },

    "validation_steps": {
      "step_1_template": "PASS",
      "step_2_files": "PASS",
      "step_3_ui": "N/A",
      "step_4_ac": "PASS",
      "step_5_testing": "PASS",
      "step_6_security": "PASS",
      "step_7_tasks": "PASS",
      "step_8_anti_hallucination": "PASS",
      "step_9_readiness": "READY",
      "step_10_report": "GENERATED"
    },

    "metrics": {
      "template_compliance_percent": 100,
      "ac_coverage_percent": 100,
      "file_structure_correct": true,
      "duration_ms": 45000
    }
  }
}
```

---

## Quick Reference

### Validation Decision Guide

**GO if:**
- No critical issues OR
- ≤ 2 critical issues AND readiness ≥ 7 AND no critical hallucinations

**NO-GO if:**
- > 2 critical issues OR
- Readiness < 7 OR
- Critical anti-hallucination findings (architecture contradictions)

### Common Critical Issues

1. Missing required sections
2. Unfilled placeholders ({{var}}, _TBD_)
3. Uncovered acceptance criteria
4. Hallucinated files/libraries/APIs
5. Circular task dependencies
6. Invalid file structure
7. No testing section
8. Vague/untestable ACs

### Common Should-Fix Issues

1. Incomplete UI specifications
2. Missing integration test scenarios
3. Vague task descriptions
4. Incomplete Dev Notes
5. Missing security considerations
6. Poor task granularity

---
